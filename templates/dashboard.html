<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>NoteIt - Dashboard</title>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&amp;display=swap" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#137fec",
                        "background-light": "#f6f7f8",
                        "background-dark": "#101922",
                        "foreground-light": "#0d141b",
                        "foreground-dark": "#f6f7f8",
                        "subtle-light": "#e7edf3",
                        "subtle-dark": "#1a2734",
                        "muted-light": "#4c739a",
                        "muted-dark": "#a0b3c6"
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.5rem",
                        "lg": "0.75rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
</head>

<body class="font-display bg-background-light dark:bg-background-dark text-foreground-light dark:text-foreground-dark">
    <div class="flex flex-col min-h-screen">
        <header class="border-b border-subtle-light dark:border-subtle-dark">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center gap-4">
                        <svg class="h-6 w-6 text-primary" fill="none" viewBox="0 0 48 48"
                            xmlns="http://www.w3.org/2000/svg">
                            <path d="M4 4H17.3334V17.3334H30.6666V30.6666H44V44H4V4Z" fill="currentColor"></path>
                        </svg>
                        <h1 class="text-xl font-bold">NoteIt</h1>
                    </div>
                    <div class="flex items-center gap-4">
                        <span class="text-sm text-muted-light dark:text-muted-dark">Welcome, {{ username }}!</span>
                        <div class="text-xs bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-200 px-3 py-1 rounded-full">
                            API Key: {{ sample_api_key }}
                        </div>
                        <button
                            class="flex items-center justify-center gap-2 px-4 py-2 bg-primary text-white rounded-full font-semibold hover:opacity-90 transition-opacity"
                            onclick="window.location.href='{{ url_for('new_note') }}'">
                            <svg fill="currentColor" height="20" viewBox="0 0 256 256" width="20"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M224,128a8,8,0,0,1-8,8H136v80a8,8,0,0,1-16,0V136H40a8,8,0,0,1,0-16h80V40a8,8,0,0,1,16,0v80h80A8,8,0,0,1,224,128Z">
                                </path>
                            </svg>
                            <span class="hidden sm:inline">New Note 1</span>
                        </button>
                        <div class="relative">
                            <button onclick="toggleDropdown()" class="w-10 h-10 rounded-full bg-primary text-white flex items-center justify-center font-semibold hover:opacity-90 transition-opacity">
                                {{ username[0].upper() }}
                            </button>
                            <div id="dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white dark:bg-subtle-dark rounded-lg shadow-lg border border-subtle-light dark:border-subtle-dark">
                                <a href="{{ url_for('logout') }}" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">Logout</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <main class="flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="max-w-3xl mx-auto">
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        <div class="mb-6">
                            {% for category, message in messages %}
                                <div class="p-4 rounded-lg mb-2 {% if category == 'error' %}bg-red-100 text-red-700 border border-red-200{% else %}bg-green-100 text-green-700 border border-green-200{% endif %}">
                                    {{ message }}
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                {% endwith %}
                
                <div class="mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg">
                    <p class="text-sm font-semibold text-blue-900 dark:text-blue-200 mb-1">Environment Variable Test:</p>
                    <p class="text-sm text-blue-800 dark:text-blue-300 font-mono">sample_api_key = {{ sample_api_key }}</p>
                </div>
                
                <div class="mb-8">
                    <form method="GET" action="{{ url_for('search_notes') }}" class="relative">
                        <span class="sr-only">Search notes</span>
                        <span
                            class="absolute inset-y-0 left-0 flex items-center pl-4 text-muted-light dark:text-muted-dark">
                            <svg fill="currentColor" height="24" viewBox="0 0 256 256" width="24"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M229.66,218.34l-50.07-50.06a88.11,88.11,0,1,0-11.31,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z">
                                </path>
                            </svg>
                        </span>
                        <input
                            name="q"
                            value="{{ search_query or '' }}"
                            class="w-full pl-14 pr-4 py-3 text-lg rounded-lg bg-background-light dark:bg-background-dark border-2 border-subtle-light dark:border-subtle-dark placeholder-muted-light dark:placeholder-muted-dark focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"
                            placeholder="Search notes..." type="search" />
                    </form>
                </div>
                <div>
                    <h2 class="text-2xl font-bold mb-4">
                        {% if search_query %}
                            Search Results for "{{ search_query }}"
                        {% else %}
                            Recent Notes
                        {% endif %}
                    </h2>
                    
                    {% if notes %}
                        <div class="space-y-2">
                            {% for note in notes %}
                                <div class="flex items-center w-full gap-4">
                                    <a class="flex flex-grow items-center gap-4 p-4 rounded-lg bg-background-light dark:bg-subtle-dark hover:bg-subtle-light dark:hover:bg-subtle-dark/50 transition-colors"
                                        href="{{ url_for('edit_note', note_id=note.id) }}">
                                        <div
                                            class="flex-shrink-0 w-12 h-12 flex items-center justify-center rounded-lg bg-subtle-light dark:bg-background-dark text-muted-light dark:text-muted-dark">
                                            <svg fill="currentColor" height="24" viewBox="0 0 256 256" width="24"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <path
                                                    d="M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40Zm0,160H40V56H216V200ZM176,96a8,8,0,0,1-8,8H88a8,8,0,0,1,0-16h80A8,8,0,0,1,176,96Zm0,32a8,8,0,0,1-8,8H88a8,8,0,0,1,0-16h80A8,8,0,0,1,176,128Zm-40,32a8,8,0,0,1-8,8H88a8,8,0,0,1,0-16h40A8,8,0,0,1,136,160Z">
                                                </path>
                                            </svg>
                                        </div>
                                        <div class="flex-1">
                                            <p class="font-semibold">{{ note.title }}</p>
                                            {% if note.content %}
                                                <p class="text-sm text-muted-light dark:text-muted-dark line-clamp-2">
                                                    {{ note.content[:100] }}{% if note.content|length > 100 %}...{% endif %}
                                                </p>
                                            {% endif %}
                                            <div class="flex items-center gap-2 mt-1">
                                                <span class="text-xs text-muted-light dark:text-muted-dark">{{ note.formatted_date }}</span>
                                                {% if note.category %}
                                                    <span class="text-xs bg-primary/10 text-primary px-2 py-1 rounded-full">{{ note.category }}</span>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </a>
                                    <form method="POST" action="{{ url_for('delete_note', note_id=note.id) }}" 
                                          onsubmit="return confirm('Are you sure you want to delete this note?')">
                                        <button type="submit"
                                            class="p-2 rounded-lg bg-gray-100 hover:bg-red-100 hover:text-red-500 transition-colors"
                                            aria-label="Delete">
                                            <svg width="20px" height="20px" viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg"
                                                fill="currentColor" class="text-gray-600">
                                                <path d="M20 18h2v16h-2z" />
                                                <path d="M24 18h2v16h-2z" />
                                                <path d="M28 18h2v16h-2z" />
                                                <path d="M12 12h26v2H12z" />
                                                <path
                                                    d="M30 12h-2v-1c0-.6-.4-1-1-1h-4c-.6 0-1 .4-1 1v1h-2v-1c0-1.7 1.3-3 3-3h4c1.7 0 3 1.3 3 3v1z" />
                                                <path
                                                    d="M31 40H19c-1.6 0-3-1.3-3.2-2.9l-1.8-24 2-.2 1.8 24c0 .6.6 1.1 1.2 1.1h12c.6 0 1.1-.5 1.2-1.1l1.8-24 2 .2-1.8 24C34 38.7 32.6 40 31 40z" />
                                            </svg>
                                        </button>
                                    </form>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-12">
                            <svg class="mx-auto h-12 w-12 text-muted-light dark:text-muted-dark mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            <h3 class="text-lg font-medium text-muted-light dark:text-muted-dark mb-2">
                                {% if search_query %}
                                    No notes found
                                {% else %}
                                    No notes yet
                                {% endif %}
                            </h3>
                            <p class="text-muted-light dark:text-muted-dark mb-6">
                                {% if search_query %}
                                    Try adjusting your search terms.
                                {% else %}
                                    Get started by creating your first note.
                                {% endif %}
                            </p>
                            {% if not search_query %}
                                <button
                                    class="inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg font-semibold hover:opacity-90 transition-opacity"
                                    onclick="window.location.href='{{ url_for('new_note') }}'">
                                    <svg fill="currentColor" height="20" viewBox="0 0 256 256" width="20">
                                        <path d="M224,128a8,8,0,0,1-8,8H136v80a8,8,0,0,1-16,0V136H40a8,8,0,0,1,0-16h80V40a8,8,0,0,1,16,0v80h80A8,8,0,0,1,224,128Z"></path>
                                    </svg>
                                    Create Your First Note
                                </button>
                            {% endif %}
                        </div>
                    {% endif %}
                </div>
            </div>
        </main>
    </div>

    <script>
        function toggleDropdown() {
            const dropdown = document.getElementById('dropdown');
            dropdown.classList.toggle('hidden');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('dropdown');
            const button = event.target.closest('button');
            if (!button || !button.onclick) {
                dropdown.classList.add('hidden');
            }
        });
    </script>

</body>

</html>